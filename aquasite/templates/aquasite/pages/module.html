{% extends 'aquasite/partials/base.html' %}

{% block title %}AQUA | Módulo {{moduleId}}{% endblock %}

{% block body-content %}
{% include 'aquasite/partials/dashboard-navbar.html' %}
  <section id="module" data-module-id="{{moduleId}}">
    <div class="container mt-5">
      <nav class="pt-4" style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="{% url 'dashboard' %}">Painel</a></li>
          <li class="breadcrumb-item active" aria-current="page">Módulo</li>
        </ol>
      </nav>
  
      <p>Nome do módulo: {{moduleName}}</p>

      <div>
        <canvas id="myChart" width="100px" height="25px"></canvas>
      </div>
    </div>
  </section>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script>
    const ctx = document.getElementById('myChart');
    let chartData = {
      type: 'line',
      data: {
        labels: ['', '', '', '', '', ''],
        datasets: [{
          label: '',
          data: [12, 19, 3, 5, 2, 3],
          borderWidth: 1
        }]
      },
      options: {
        scales: {
          y: {
            min: 0,
            max: 50,
          }
        },
        plugins: {
          legend: {
              display: false
          }
        }
      }
    }
    let moduleChart = new Chart(ctx, chartData)

    const moduleId = document.getElementById('module').getAttribute('data-module-id')
    let moduleSocket = new WebSocket(
      'ws://' +
      window.location.host +
      '/dashboard/module/' +
      moduleId +
      '/'
    )
    moduleSocket.onmessage = (e) => {
      const djangoData = JSON.parse(e.data)
      console.log(djangoData)
      let newChartData = chartData.data.datasets[0].data
      newChartData.shift()
      newChartData.push(djangoData.temperature)
      chartData.data.datasets[0].data = newChartData
      moduleChart.update()
    }
  </script>
{% endblock %}